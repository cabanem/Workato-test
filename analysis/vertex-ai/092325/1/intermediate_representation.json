{
  "connector": {
    "title": "Google Vertex AI",
    "auth_modes": ["oauth2", "custom_service_account"]
  },
  "actions": [
    {
      "name": "send_messages",
      "input_object_defs": ["send_messages_input"],
      "output_object_defs": ["send_messages_output"],
      "execute": {
        "method": "run_vertex",
        "params": { "template": "send_message", "verb": "generate" },
        "transitive_calls": [
          "validate_publisher_model!",
          "build_ai_payload → get_ai_template → process_ai_template → build_conversation_payload",
          "vertex_url_for",
          "rate_limited_ai_request → enforce_vertex_rate_limits, handle_429_with_backoff → api_request",
          "extract_response"
        ]
      },
      "picklists_used": [
        "available_text_models",
        "message_types",
        "chat_role",
        "function_call_mode",
        "safety_categories",
        "safety_threshold",
        "safety_method",
        "response_type"
      ]
    },
    {
      "name": "translate_text",
      "input_object_defs": ["translate_text_input"],
      "output_object_defs": ["translate_text_output"],
      "execute": {
        "method": "run_vertex",
        "params": { "template": "translate", "verb": "generate", "extract": "generic_json" }
      },
      "picklists_used": ["available_text_models", "languages_picklist", "safety_categories", "safety_threshold", "safety_method"]
    },
    {
      "name": "summarize_text",
      "input_object_defs": ["summarize_text_input"],
      "output_object_defs": ["summarize_text_output"],
      "execute": { "method": "run_vertex", "params": { "template": "summarize", "verb": "generate", "extract": "generic" } },
      "picklists_used": ["available_text_models", "safety_categories", "safety_threshold", "safety_method"]
    },
    {
      "name": "parse_text",
      "input_object_defs": ["parse_text_input"],
      "output_object_defs": ["parse_text_output"],
      "execute": { "method": "run_vertex", "params": { "template": "parse", "verb": "generate", "extract": "parsed" } },
      "picklists_used": ["available_text_models", "safety_categories", "safety_threshold", "safety_method"]
    },
    {
      "name": "draft_email",
      "input_object_defs": ["draft_email_input"],
      "output_object_defs": ["draft_email_output"],
      "execute": { "method": "run_vertex", "params": { "template": "email", "verb": "generate", "extract": "email" } },
      "picklists_used": ["available_text_models", "safety_categories", "safety_threshold", "safety_method"]
    },
    {
      "name": "ai_classify",
      "input_object_defs": [],
      "output_object_defs": [],
      "execute": { "method": "run_vertex", "params": { "template": "ai_classify", "verb": "generate", "extract": "classify" } },
      "picklists_used": ["available_text_models", "safety_categories", "safety_threshold", "safety_method"]
    },
    {
      "name": "analyze_text",
      "input_object_defs": ["analyze_text_input"],
      "output_object_defs": ["analyze_text_output"],
      "execute": { "method": "run_vertex", "params": { "template": "analyze", "verb": "generate", "extract": "generic_json" } },
      "picklists_used": ["available_text_models", "safety_categories", "safety_threshold", "safety_method"]
    },
    {
      "name": "analyze_image",
      "input_object_defs": ["analyze_image_input"],
      "output_object_defs": ["analyze_image_output"],
      "execute": {
        "method": "run_vertex",
        "params": { "template": "analyze", "verb": "generate", "extract": "generic_json" },
        "note": "Likely should pass template 'analyze_image' to use build_image_payload"
      },
      "picklists_used": ["available_image_models", "safety_categories", "safety_threshold", "safety_method"]
    },
    {
      "name": "generate_embeddings",
      "input_object_defs": [],
      "output_object_defs": [],
      "execute": { "method": "generate_embeddings_batch_exec" },
      "picklists_used": ["available_embedding_models", "embedding_task_list"]
    },
    {
      "name": "generate_embedding_single",
      "input_object_defs": [],
      "output_object_defs": [],
      "execute": { "method": "generate_embedding_single_exec" },
      "picklists_used": ["available_embedding_models", "embedding_task_list"]
    },
    {
      "name": "find_neighbors",
      "input_object_defs": ["find_neighbors_input"],
      "output_object_defs": ["find_neighbors_output"],
      "execute": {
        "method": "api_request",
        "params": { "url": "https://{host}/{version}/projects/{project}/locations/{region}/indexEndpoints/{endpoint_id}:findNeighbors" },
        "pipeline": [
          "build_ai_payload(:find_neighbors) → payload_for_find_neighbors",
          "normalize_host",
          "api_request (custom error handler → handle_vertex_error)",
          "transform_find_neighbors_response → to_similarity"
        ]
      },
      "picklists_used": ["numeric_comparison_op"]
    },
    {
      "name": "upsert_index_datapoints",
      "execute": {
        "method": "batch_upsert_datapoints",
        "pipeline": ["validate_index_access", "process_datapoint_batch → build_upsert_payload → api_request"]
      }
    },
    {
      "name": "test_connection",
      "execute": {
        "method": "composed",
        "pipeline": [
          "init_test_results",
          "run_service_test(Vertex) → probe_vertex_ai",
          "run_service_test(Drive) → probe_drive",
          "optional run_service_test(Index) → probe_index",
          "add_quota_info (optional)",
          "calculate_summary",
          "determine_overall_status"
        ]
      }
    },
    {
      "name": "get_prediction (legacy)",
      "execute": { "method": "post_raw", "url": "…/publishers/google/models/text-bison:predict" },
      "output_object_defs": ["prediction"]
    },
    {
      "name": "fetch_drive_file",
      "output_object_defs": ["drive_file_extended"],
      "execute": { "method": "fetch_drive_file_full", "pre": ["extract_drive_file_id"] }
    },
    {
      "name": "list_drive_files",
      "execute": {
        "method": "api_request(Drive)",
        "pre": ["extract_drive_file_id (folder)", "build_drive_query"]
      }
    },
    {
      "name": "batch_fetch_drive_files",
      "execute": { "method": "loop(fetch_drive_file_full)", "pre": ["extract_drive_file_id"] }
    },
    {
      "name": "monitor_drive_changes",
      "execute": {
        "method": "api_request(Drive changes)",
        "post": ["classify_drive_change"]
      }
    }
  ],
  "methods": [
    {
      "name": "run_vertex",
      "calls": ["validate_publisher_model!", "build_ai_payload", "vertex_url_for", "rate_limited_ai_request", "extract_response"]
    },
    {
      "name": "build_ai_payload",
      "calls": ["get_ai_template", "process_ai_template"]
    },
    {
      "name": "process_ai_template",
      "calls": ["build_conversation_payload | build_image_payload | build_embedding_payload | build_neighbors_payload | build_base_payload"]
    },
    { "name": "build_conversation_payload", "calls": ["maybe_parse_json", "build_message_parts"] },
    { "name": "build_message_parts", "calls": ["maybe_parse_json"] },
    { "name": "build_classify_payload", "calls": ["build_base_payload"] },
    { "name": "build_image_payload", "calls": ["payload_for_analyze_image"] },
    { "name": "build_embedding_payload", "calls": ["payload_for_text_embedding"] },
    { "name": "build_neighbors_payload", "calls": ["payload_for_find_neighbors"] },
    { "name": "rate_limited_ai_request", "calls": ["enforce_vertex_rate_limits", "handle_429_with_backoff", "api_request"] },
    { "name": "handle_429_with_backoff", "calls": ["is_rate_limit_error", "extract_retry_after", "calculate_retry_delay"] },
    { "name": "fetch_publisher_models", "calls": ["cascade_model_discovery"] },
    { "name": "cascade_model_discovery", "calls": ["fetch_fresh_publisher_models", "get_static_model_list"] },
    { "name": "fetch_fresh_publisher_models", "calls": ["api_request"] },
    { "name": "dynamic_model_picklist", "calls": ["fetch_publisher_models", "to_model_options"] },
    { "name": "to_model_options", "calls": ["vertex_model_bucket", "create_model_label", "sort_model_options"] },
    { "name": "validate_publisher_model!", "calls": ["api_request", "handle_vertex_error"] },
    { "name": "generate_embeddings_batch_exec", "calls": ["validate_publisher_model!", "process_embedding_batch", "process_embedding_prediction", "estimate_token_count"] },
    { "name": "process_embedding_batch", "calls": ["circuit_breaker_retry", "build_embedding_instance", "rate_limited_ai_request"] },
    { "name": "generate_embedding_single_exec", "calls": ["validate_publisher_model!", "build_ai_payload", "vertex_url_for", "rate_limited_ai_request", "extract_embedding_values"] },
    { "name": "find_neighbors.execute", "calls": ["build_ai_payload", "normalize_host", "api_request", "transform_find_neighbors_response"] },
    { "name": "transform_find_neighbors_response", "calls": ["to_similarity", "neighbors_max_distance"] },
    { "name": "batch_upsert_datapoints", "calls": ["validate_index_access", "process_datapoint_batch"] },
    { "name": "process_datapoint_batch", "calls": ["build_upsert_payload", "api_request"] },
    { "name": "validate_index_access", "calls": ["api_request", "handle_vertex_error"] },
    { "name": "fetch_drive_file_full", "calls": ["api_request(Drive file)", "fetch_file_content"] },
    { "name": "fetch_file_content", "calls": ["api_request(Drive export/download)"] },
    { "name": "list_drive_files.execute", "calls": ["build_drive_query", "api_request(Drive list)"] },
    { "name": "monitor_drive_changes.execute", "calls": ["api_request(Drive startPageToken/changes)", "classify_drive_change"] },
    { "name": "probe_vertex_ai", "calls": ["api_request"] },
    { "name": "probe_drive", "calls": ["api_request"] },
    { "name": "probe_index", "calls": ["validate_index_access"] }
  ],
  "object_definitions": [
    { "name": "text_model_schema", "used_by": ["send_messages_input", "translate_text_input", "summarize_text_input", "parse_text_input", "draft_email_input", "analyze_text_input"] },
    { "name": "config_schema", "used_by": ["send_messages_input", "translate_text_input", "summarize_text_input", "parse_text_input", "draft_email_input", "analyze_text_input"] },
    { "name": "send_messages_input", "used_by_actions": ["send_messages"] },
    { "name": "send_messages_output", "used_by_actions": ["send_messages"] },
    { "name": "translate_text_input", "used_by_actions": ["translate_text"] },
    { "name": "translate_text_output", "used_by_actions": ["translate_text"] },
    { "name": "summarize_text_input", "used_by_actions": ["summarize_text"] },
    { "name": "summarize_text_output", "used_by_actions": ["summarize_text"] },
    { "name": "parse_text_input", "used_by_actions": ["parse_text"] },
    { "name": "parse_text_output", "used_by_actions": ["parse_text"] },
    { "name": "draft_email_input", "used_by_actions": ["draft_email"] },
    { "name": "draft_email_output", "used_by_actions": ["draft_email"] },
    { "name": "analyze_text_input", "used_by_actions": ["analyze_text"] },
    { "name": "analyze_text_output", "used_by_actions": ["analyze_text"] },
    { "name": "analyze_image_input", "used_by_actions": ["analyze_image"] },
    { "name": "analyze_image_output", "used_by_actions": ["analyze_image"] },
    { "name": "find_neighbors_input", "used_by_actions": ["find_neighbors"] },
    { "name": "find_neighbors_output", "used_by_actions": ["find_neighbors"] },
    { "name": "prediction", "used_by_actions": ["get_prediction (legacy)"] },
    { "name": "drive_file_fields", "used_by_actions": ["list_drive_files"] },
    { "name": "drive_file_extended", "used_by_actions": ["fetch_drive_file", "batch_fetch_drive_files"] }
  ],
  "pick_lists": [
    { "name": "available_text_models", "source": "dynamic_model_picklist[:text] or static_model_options[:text]", "used_by": ["text_model_schema", "ai_classify.model"] },
    { "name": "available_image_models", "source": "dynamic_model_picklist[:image] or static_model_options[:image]", "used_by": ["analyze_image_input.model"] },
    { "name": "available_embedding_models", "source": "dynamic_model_picklist[:embedding] or static_model_options[:embedding]", "used_by": ["generate_embeddings.model", "generate_embedding_single.model"] },
    { "name": "message_types", "used_by": ["send_messages_input.message_type"] },
    { "name": "chat_role", "used_by": ["send_messages_input.messages.chat_transcript.role"] },
    { "name": "function_call_mode", "used_by": ["config_schema.toolConfig.functionCallingConfig.mode"] },
    { "name": "safety_categories", "used_by": ["config_schema.safetySettings.category"] },
    { "name": "safety_threshold", "used_by": ["config_schema.safetySettings.threshold"] },
    { "name": "safety_method", "used_by": ["config_schema.safetySettings.method"] },
    { "name": "response_type", "used_by": ["config_schema.generationConfig.responseMimeType"] },
    { "name": "languages_picklist", "used_by": ["translate_text_input.to", "translate_text_input.from"] },
    { "name": "numeric_comparison_op", "used_by": ["find_neighbors_input.queries.datapoint.numericRestricts.op"] },
    { "name": "embedding_task_list", "used_by": ["generate_embeddings.task_type", "generate_embedding_single.task_type"] }
  ]
}
